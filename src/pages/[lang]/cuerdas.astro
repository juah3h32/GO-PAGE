---
// src/pages/[lang]/cuerdas.astro

// 1. IMPORTACIONES
import "../../styles/cuerdas.css";
import BaseLayout from "../../layouts/BaseLayout.astro";
import CustomCursor from "../../components/CustomCursor.astro";
import AudioVisualizer from "../../components/AudioVisualizer.astro";
import BuyButton from "../../components/BuyButton.astro";
import Navbar from "../../components/Nadbar.astro"; 
import { languages, translations } from "../../i18n";

// 2. GENERACIÓN DE RUTAS DINÁMICA
export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

// 3. LÓGICA DE IDIOMA Y DATOS
const { lang } = Astro.params;
const currentLang = (lang && lang in translations) ? lang : 'es';
const t = translations[currentLang as keyof typeof translations];

// Datos
const pageData = t.cuerdas;
const productsList = pageData.products; 
const firstProduct = productsList[0];
const specsLabels = pageData.specs_labels;

const specs = [
  { label: specsLabels.load,   id: "spec-load",       tag: firstProduct.specs_values.load },
  { label: specsLabels.unit,   id: "spec-diam",       tag: firstProduct.specs_values.unit },
  { label: specsLabels.mat,    id: "spec-mat",        tag: firstProduct.specs_values.mat },
  { label: specsLabels.weight, id: "spec-elong",      tag: firstProduct.specs_values.weight },
  { label: specsLabels.resist, id: "spec-grip",       tag: firstProduct.specs_values.resist },
  { label: specsLabels.charge, id: "spec-loadresist", tag: firstProduct.specs_values.charge },
];

// Helper para estilos condicionales (ahorra código abajo)
const rtlStyle = currentLang === 'ar' ? { textAlign: 'left' } : {};
const dirValue = currentLang === 'ar' ? 'rtl' : 'ltr';
---

<BaseLayout title={pageData.meta_title}>
  <script is:inline type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
  <script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.0.1/dist/gsap.min.js"></script>

  <Navbar currentLang={currentLang} />
  <CustomCursor />

  <main 
    class="main-container" 
    data-products={JSON.stringify(productsList)}
  >

    <div class="content">
      <a href={`/${currentLang}/productos`} class="back-arrow-btn" aria-label={pageData.back_aria}>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12" />
          <polyline points="12 19 5 12 12 5" />
        </svg>
      </a>
    
      {/* CAMBIO 1: El contenedor padre (.text-area) se queda LIMPIO.
          Sin 'dir' ni 'style'. Esto asegura que Flexbox siga alineando
          todo a la izquierda (Start = Left en modo LTR).
      */}
      <div class="text-area">
        
         {/* CAMBIO 2: Aplicamos la lógica árabe individualmente al Título */}
         <h1 
            id="product-title" 
            class="fade-in-text"
            dir={dirValue}
            style={rtlStyle}
         >
            {firstProduct.name}
         </h1>

         {/* CAMBIO 3: Aplicamos la lógica árabe individualmente a la Descripción */}
         <p 
            id="product-desc" 
            class="fade-in-text"
            dir={dirValue}
            style={rtlStyle}
         >
            {firstProduct.description}
         </p>

        {/* CAMBIO 4: Aplicamos la lógica árabe al contenedor de Specs */}
        <div 
            class="specs-container fade-in-text"
            dir={dirValue}
            style={rtlStyle}
        >
          <h3 class="specs-title">{pageData.specs_title}</h3>

          <div class="specs-grid">
            {specs.map((spec) => (
              <div class="spec-box">
                <span class="spec-label">{spec.label}</span>
                <span class="spec-value" id={spec.id}>{spec.tag}</span>
              </div>
            ))}
          </div>
        </div>

        {/* CAMBIO 5: Simplificamos el botón.
            Como el padre (.text-area) ya es LTR, 'justify-start' SIEMPRE significa Izquierda.
            Ya no necesitamos la condición ternaria compleja.
        */}
<div class="fade-in-text w-full flex justify-center lg:justify-start">
  <BuyButton 
      text={t.common.buy || 'Comprar'} 
      redirecting={t.common.redirecting || 'Redirigiendo...'} 
  />
</div>
      </div>

      <div class="thumbnails fade-in-text">
        {productsList.map((prod, index) => (
          <div
            class={`thumb-item ${index === 0 ? 'active' : ''}`}
            data-index={index}
            data-link={prod.link}
          >
            <img src={prod.img} alt={prod.name} />
          </div>
        ))}
      </div>
    </div>

    <div class="wheel-container">
      <div class="wheel" id="product-wheel">
        <model-viewer
          id="rafia-3d"
          src="/models/rafiaNegra.glb"
          alt="Modelo 3D"
          camera-orbit="0deg 90deg 180%"
          min-camera-orbit="auto auto 300%"
          camera-controls
          auto-rotate
          interaction-prompt="none"
          class="model-3d-custom" 
          style="display:none;"
        ></model-viewer>

        {productsList.map((prod, index) => (
          <div class={`wheel-item item-${index} ${index === 0 ? 'active' : ''}`}>
            <img src={prod.img} alt={prod.name} />
          </div>
        ))}
      </div>
    </div>

    <div style="position: fixed; bottom: 30px; right: 96px; z-index: 100; pointer-events: none;">
         <div style="pointer-events: auto;">
             <AudioVisualizer transition:persist />
         </div>
    </div>

  </main>

  <script src="/scripts/cuerdas.js" defer></script>
</BaseLayout>