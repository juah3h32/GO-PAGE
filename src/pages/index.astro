---
// src/pages/index.astro

// 1. Obtener la preferencia de idioma del navegador/sistema del usuario
// Esto devuelve una cadena como: "en-US,en;q=0.9,es;q=0.8"
const acceptLanguage = Astro.request.headers.get('accept-language') || '';

// 2. Convertir a minúsculas para facilitar la búsqueda
const langHeader = acceptLanguage.toLowerCase();

// 3. Definir el idioma por defecto (Fallback)
let targetLang = 'es';

// 4. Lógica de Detección
// Verificamos si la cadena contiene los códigos de los idiomas que soportas.
// El orden del 'if/else' define la prioridad si el usuario tiene varios.

if (langHeader.includes('en')) {
  // Detecta inglés (en-US, en-GB, etc.)
  targetLang = 'en';
} 
else if (langHeader.includes('pt') || langHeader.includes('br')) {
  // Detecta portugués o referencias a Brasil
  targetLang = 'pt';
} 
else if (langHeader.includes('zh') || langHeader.includes('cn')) {
  // Detecta chino
  targetLang = 'zh';
} 
else if (langHeader.includes('ar')) {
  // Detecta árabe
  targetLang = 'ar';
}
// Si no cae en ninguno de los anteriores, se queda en 'es'

// 5. Redirección automática
return Astro.redirect(`/${targetLang}/`);
---