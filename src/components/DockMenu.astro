---
/* src/components/DockMenu.astro */
const currentPath = Astro.url.pathname;
const lang = currentPath.split('/')[1] || 'es';

/* LÓGICA DE ACTIVACIÓN */
const isProducts = currentPath.includes('productos');
const isHome = !isProducts && (currentPath === '/' || currentPath === `/${lang}` || currentPath === `/${lang}/`);

/* LISTA NEGRA */
const rutasOcultas = ['cuerdas', 'otra-pagina-si-quieres'];
const debeOcultarse = rutasOcultas.some(ruta => currentPath.includes(ruta));
---

{ !debeOcultarse && (

<nav class="dock-wrapper">
  <div class="glass-dock">
  
    <a href={`/${lang}`} class={`dock-item ${isHome ? 'active' : ''}`} aria-label="Inicio">
      <div class="icon-box">
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      </div>
      <span class="dot"></span>
    </a>

    <a href={`/${lang}/productos`} class={`dock-item ${isProducts ? 'active' : ''}`} aria-label="Productos">
      <div class="icon-box">
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
      </div>
      <span class="dot"></span>
    </a>

    <a href="https://wa.me/521234567890" target="_blank" class="dock-item" aria-label="WhatsApp">
      <div class="icon-box whatsapp-highlight">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
      </div>
    </a>

    <a href="javascript:history.back()" class="dock-item" aria-label="Regresar">
      <div class="icon-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
      </div>
    </a>

  </div>
</nav>

)}

<style>
  /* --- VARS --- */
  :root {
    --dock-bg: rgba(255, 255, 255, 0.85); /* Fondo semitransparente */
    --dock-border: rgba(255, 255, 255, 0.6);
    --primary-color: #F05537;
    --text-inactive: #A0A0A0;
    --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  }

  /* --- DESKTOP (OCULTO) --- */
  .dock-wrapper { display: none; }

  /* --- MOBILE --- */
  @media screen and (max-width: 1024px) {
    .dock-wrapper {
        display: flex;
        justify-content: center;
        position: fixed;
        bottom: 20px; /* Flotante: separado del fondo */
        left: 0;
        width: 100%;
        z-index: 2000;
        pointer-events: none; /* Permite clicks a los lados del dock */
        padding-bottom: env(safe-area-inset-bottom);
    }

    .glass-dock {
        pointer-events: auto;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        width: 92%; /* Ancho de la "isla" */
        max-width:auto;
        height: 70px;
        background: var(--dock-bg);
        backdrop-filter: blur(12px); /* EFECTO VIDRIO */
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--dock-border);
        border-radius: 24px;
        box-shadow: var(--shadow-soft);
        align-items: center;
        justify-items: center;
        padding: 0 10px;
    }

    .dock-item {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        text-decoration: none;
        color: var(--text-inactive);
        -webkit-tap-highlight-color: transparent;
        transition: transform 0.1s ease;
    }

    /* Efecto de presión (Click) */
    .dock-item:active {
        transform: scale(0.9);
    }

    .icon-box {
        position: relative;
        width: 42px;
        height: 42px;
        border-radius: 16px; /* Squircle moderno */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        z-index: 2;
    }

    .dock-item svg {
        width: 24px;
        height: 24px;
        stroke-width: 2px;
        transition: all 0.3s ease;
    }

    /* --- ESTADO ACTIVO --- */
    .dock-item.active .icon-box {
        background: var(--primary-color);
        color: white;
        transform: translateY(-25px) scale(1.15); /* Flota hacia arriba */
        box-shadow: 0 8px 20px rgba(240, 85, 55, 0.4);
        border-radius: 50%; /* Se vuelve circular al flotar */
        
        /* Borde falso para simular recorte contra el vidrio */
        outline: 6px solid rgba(255, 255, 255, 0.85); 
    }

    /* Pequeño punto indicador debajo si se desea, o para decoración */
    .dot {
        position: absolute;
        bottom: 8px;
        width: 4px;
        height: 4px;
        background-color: var(--primary-color);
        border-radius: 50%;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s ease;
    }

    .dock-item.active .dot {
        opacity: 1;
        transform: scale(1);
        bottom: 12px; /* Ajuste visual */
    }

    /* --- WHATSAPP ESPECIAL --- */
    /* Opcional: Dale un toque verde sutil al icono de WA */
    .dock-item:hover .whatsapp-highlight {
        color: #25D366;
    }
  }
</style>